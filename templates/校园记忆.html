<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>å…ƒé‚®èƒ¶å›Š - æ ¡å›­è®°å¿†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== åŸæœ‰ CSS å®Œå…¨ä¸å˜ï¼Œæ­¤å¤„çœç•¥ï¼Œç›´æ¥ç”¨ä½ åŸæ¥çš„å…¨éƒ¨æ ·å¼ ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei", "å¾®è½¯é›…é»‘", "PingFang SC", sans-serif;}
body{background:#f5f8fc;color:#333;line-height:1.6;overflow-x:hidden;}
.bg{
  position:fixed;
  width:100%;
  height:100%;
  background:url(/static/bg.jpg) center/cover no-repeat;
  opacity:0.7;
  filter:blur(1.5px) brightness(1.05);
  z-index:-1;
}
.bg::after{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:linear-gradient(135deg, rgba(120, 180, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%);
}

/* é¡µé¢é¡¶éƒ¨æ ·å¼ä¼˜åŒ– */
.header{
  padding:30px 25px 25px;
  text-align:center;
  position:relative;
  background:linear-gradient(to bottom, rgba(255,255,255,0.98), rgba(255,255,255,0.85));
  border-bottom:1px solid rgba(31,86,179,0.08);
  box-shadow:0 4px 20px rgba(31,86,179,0.08);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}

.back-btn{
  position:absolute;
  left:25px;
  top:50%;
  transform:translateY(-50%);
  background:linear-gradient(135deg, #fff, #f8fbff);
  padding:10px 20px;
  border-radius:12px;
  color:#1f56b3;
  cursor:pointer;
  text-decoration:none;
  border:1px solid rgba(31,86,179,0.12);
  transition:all 0.3s ease;
  font-weight:600;
  font-size:15px;
  display:flex;
  align-items:center;
  gap:6px;
  box-shadow:0 3px 12px rgba(31,86,179,0.1);
}
.back-btn:hover{
  background:linear-gradient(135deg, #f0f5ff, #e8f0ff);
  transform:translateY(-50%) translateX(-2px);
  box-shadow:0 6px 18px rgba(31,86,179,0.18);
  border-color:rgba(31,86,179,0.2);
}

.page-title{
  color:#1f56b3;
  font-size:38px;
  margin:0 0 8px;
  font-weight:700;
  letter-spacing:0.5px;
  text-shadow:0 2px 8px rgba(31,86,179,0.12);
  background:linear-gradient(135deg, #1f56b3, #3a7bd5);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.subtitle{
  color:#6a8bc5;
  font-size:16px;
  font-weight:400;
  opacity:0.9;
  letter-spacing:0.3px;
}

/* å»ºç­‘å¡ç‰‡åŒºåŸŸä¼˜åŒ– */
.building-container{
  width:94%;
  max-width:1280px;
  margin:35px auto;
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(260px, 1fr));
  gap:22px;
  padding:5px;
}

.building-card{
  background:#fff;
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 6px 20px rgba(0,0,0,0.08);
  cursor:pointer;
  transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
  position:relative;
  border:1px solid rgba(255,255,255,0.8);
}
.building-card:hover{
  transform:translateY(-10px) scale(1.02);
  box-shadow:0 15px 35px rgba(31,86,179,0.18);
  border-color:rgba(31,86,179,0.2);
}
.building-card::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
  transform:translateX(-100%);
  transition:transform 0.8s;
}
.building-card:hover::before{
  transform:translateX(100%);
}

.building-img{
  width:100%;
  height:180px;
  object-fit:cover;
  display:block;
  transition:transform 0.6s ease;
  filter:brightness(0.98);
}
.building-card:hover .building-img{
  transform:scale(1.08);
  filter:brightness(1.05);
}

.building-name{
  padding:18px;
  text-align:center;
  color:#1f56b3;
  font-size:17px;
  font-weight:600;
  letter-spacing:0.3px;
  background:#fff;
  border-top:1px solid rgba(240,245,255,0.9);
  position:relative;
  overflow:hidden;
}
.building-name::after{
  content:'';
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:40px;
  height:3px;
  background:linear-gradient(to right, #1f56b3, #4a90e2);
  border-radius:2px;
  transition:width 0.3s ease;
}
.building-card:hover .building-name::after{
  width:80px;
}

/* å›å¿†å¼¹çª—ä¼˜åŒ– */
.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.65);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
  backdrop-filter:blur(4px);
  -webkit-backdrop-filter:blur(4px);
  animation:modalFadeIn 0.3s ease;
}
@keyframes modalFadeIn {
  from {opacity:0;}
  to {opacity:1;}
}

/* ã€æ”¹åŠ¨1ã€‘å¼¹çª—åŠ å¤§ï¼šwidth 680pxï¼Œmax-height 90vh */
.modal-box{
  width:680px;
  max-width:90vw;
  max-height:90vh;
  background:#fff;
  padding:30px;
  border-radius:22px;
  box-shadow:0 15px 45px rgba(0,0,0,0.2);
  animation:modalSlideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position:relative;
  overflow-y:auto;
  border:1px solid rgba(255,255,255,0.8);
}
@keyframes modalSlideUp {
  from {opacity:0;transform:translateY(40px);}
  to {opacity:1;transform:translateY(0);}
}

.close-btn{
  position:absolute;
  top:15px;
  right:15px;
  color:#99a9d1;
  cursor:pointer;
  font-size:26px;
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  transition:all 0.2s;
  z-index:10;
  background:rgba(255,255,255,0.9);
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
.close-btn:hover{
  color:#1f56b3;
  background:#fff;
  transform:rotate(90deg) scale(1.1);
  box-shadow:0 4px 12px rgba(31,86,179,0.15);
}

.modal-title{
  color:#1f56b3;
  font-size:24px;
  text-align:center;
  padding-bottom:20px;
  border-bottom:1px solid #f0f5ff;
  margin-bottom:25px;
  font-weight:700;
  position:relative;
}
.modal-title::after{
  content:'';
  position:absolute;
  bottom:-1px;
  left:50%;
  transform:translateX(-50%);
  width:100px;
  height:3px;
  background:linear-gradient(to right, #1f56b3, #4a90e2, #1f56b3);
  border-radius:2px;
}

.memory-input{
  width:100%;
  min-height:120px;
  padding:18px;
  border:1px solid #e8efff;
  border-radius:14px;
  margin:18px 0;
  resize:vertical;
  font-size:15px;
  line-height:1.6;
  transition:all 0.3s;
  background:#f9fbff;
  color:#333;
}
.memory-input:focus{
  outline:none;
  border-color:#1f56b3;
  box-shadow:0 0 0 4px rgba(31,86,179,0.12);
  background:#fff;
}
.memory-input::placeholder{
  color:#8ba3cc;
  font-style:italic;
}

/* æŒ‰é’®ç»„ä¼˜åŒ– */
.btns-group{
  display:flex;
  gap:15px;
  margin-top:28px;
}
.save-btn,.view-btn{
  flex:1;
  padding:16px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  transition:all 0.3s;
  font-weight:600;
  letter-spacing:0.5px;
  position:relative;
  overflow:hidden;
}
.save-btn::before,.view-btn::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
  transform:translateX(-100%);
}
.save-btn:hover::before,.view-btn:hover::before{
  transform:translateX(100%);
  transition:transform 0.8s;
}

.save-btn{
  background:linear-gradient(135deg, #1f56b3, #3a7bd5);
  color:#fff;
  box-shadow:0 6px 20px rgba(31,86,179,0.25);
}
.save-btn:hover{
  background:linear-gradient(135deg, #174a9e, #2e6bc8);
  transform:translateY(-3px);
  box-shadow:0 10px 25px rgba(31,86,179,0.35);
}

.view-btn{
  background:#f0f7ff;
  color:#1f56b3;
  border:1px solid #d5e4ff;
  box-shadow:0 4px 15px rgba(31,86,179,0.12);
}
.view-btn:hover{
  background:#e1eeff;
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(31,86,179,0.2);
}

/* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸä¼˜åŒ– */
.upload-area{
  margin:20px 0;
  padding:25px;
  border:2px dashed #d5e4ff;
  border-radius:14px;
  text-align:center;
  background:#f9fbff;
  cursor:pointer;
  transition:all 0.3s;
  position:relative;
  overflow:hidden;
}
.upload-area:hover{
  border-color:#1f56b3;
  background:#f0f7ff;
  transform:translateY(-3px);
  box-shadow:0 6px 20px rgba(31,86,179,0.15);
}

.upload-icon{
  font-size:36px;
  color:#1f56b3;
  margin-bottom:12px;
  display:inline-block;
  animation:float 3s ease-in-out infinite;
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.upload-text{
  font-size:16px;
  color:#4a6fa5;
  font-weight:500;
  margin-bottom:6px;
}
.upload-hint{
  font-size:13px;
  color:#8ba3cc;
}

#imagePreview{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
  gap:15px;
  margin-top:20px;
}

.preview-item{
  position:relative;
  width:100%;
  height:100px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
  transition:all 0.3s;
}
.preview-item:hover{
  transform:scale(1.05) rotate(2deg);
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}

.preview-img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.remove-img{
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(0,0,0,0.7);
  color:white;
  border:none;
  border-radius:50%;
  width:28px;
  height:28px;
  font-size:16px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.2s;
  opacity:0.8;
}
.remove-img:hover{
  background:rgba(0,0,0,0.9);
  opacity:1;
  transform:scale(1.15);
}

/* å›å¿†åˆ—è¡¨æ˜¾ç¤ºä¼˜åŒ– */
.memory-container{
  margin-top:25px;
  max-height:380px;
  overflow-y:auto;
  padding:20px;
  background:linear-gradient(to bottom, #f9fbff, #f5f9ff);
  border-radius:16px;
  border:1px solid #e8f0ff;
  scrollbar-width:thin;
  scrollbar-color:#1f56b3 #f0f5ff;
}
.memory-container::-webkit-scrollbar{
  width:8px;
}
.memory-container::-webkit-scrollbar-track{
  background:#f0f5ff;
  border-radius:4px;
}
.memory-container::-webkit-scrollbar-thumb{
  background:#1f56b3;
  border-radius:4px;
}

.memory-item{
  padding:22px;
  border-bottom:1px solid #e8f0ff;
  background:#fff;
  border-radius:14px;
  margin-bottom:18px;
  box-shadow:0 4px 15px rgba(31,86,179,0.06);
  transition:all 0.3s;
  border-left:4px solid transparent;
}
.memory-item:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 25px rgba(31,86,179,0.12);
  border-left-color:#1f56b3;
}

.user-header{
  display:flex;
  align-items:center;
  margin-bottom:18px;
}

.memory-avatar{
  width:52px;
  height:52px;
  border-radius:50%;
  overflow:hidden;
  margin-right:18px;
  background:linear-gradient(135deg, #e0e8ff, #c9d7ff);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  color:#1f56b3;
  font-weight:bold;
  flex-shrink:0;
  border:3px solid #fff;
  box-shadow:0 4px 15px rgba(31,86,179,0.15);
}

.memory-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.user-info {
  flex: 1;
}

.memory-nickname {
  font-size:16px;
  color:#1f56b3;
  font-weight:600;
  margin-bottom:6px;
}

.memory-time {
  font-size:14px;
  color:#8ba3cc;
  display:flex;
  align-items:center;
}
.memory-time::before{content:'ğŸ•';margin-right:6px;font-size:12px;}

.memory-text {
  font-size:15px;
  color:#333;
  line-height:1.7;
  margin-bottom:18px;
  padding:15px 0;
  border-top:1px solid #f5f9ff;
  border-bottom:1px solid #f5f9ff;
}

/* å›å¿†å›¾ç‰‡æ˜¾ç¤ºä¼˜åŒ– */
.memory-images {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
  gap:12px;
  margin-top:18px;
}

.memory-image-item {
  width:100%;
  height:100px;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  position:relative;
  transition:all 0.3s;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
}
.memory-image-item:hover {
  transform:scale(1.08) rotate(1deg);
  box-shadow:0 8px 25px rgba(0,0,0,0.25);
}

.memory-image-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-count {
  position: absolute;
  bottom: 0;
  right: 0;
  background: rgba(0,0,0,0.7);
  color: white;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 8px 0 0 0;
}

.no-memories {
  color:#8ba3cc;
  padding:45px 25px;
  text-align:center;
  font-size:16px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(31,86,179,0.05);
  border:2px dashed #e8f0ff;
}
.no-memories::before{
  content:'âœ¨';
  display:block;
  font-size:32px;
  margin-bottom:15px;
  animation:float 3s ease-in-out infinite;
}

/* å›¾ç‰‡æ”¾å¤§å¼¹çª—ä¼˜åŒ– */
.img-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.92);display:none;justify-content:center;align-items:center;z-index:9999;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);animation:fadeIn 0.3s ease;}
@keyframes fadeIn {
  from {opacity:0;}
  to {opacity:1;}
}

.big-img{
  max-width:85%;
  max-height:85%;
  border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
  animation:zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes zoomIn {
  from {opacity:0;transform:scale(0.9);}
  to {opacity:1;transform:scale(1);}
}

.close-img{position:absolute;top:30px;right:40px;color:#fff;font-size:40px;cursor:pointer;transition:all 0.3s;background:rgba(0,0,0,0.5);width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.close-img:hover{background:rgba(0,0,0,0.7);transform:rotate(90deg) scale(1.1);}

/* æ¸©æŸ”æç¤ºå¼¹çª—ä¼˜åŒ– */
.success-tips{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  background:#fff;padding:40px 50px;border-radius:20px;box-shadow:0 15px 50px rgba(0,0,0,0.25);
  z-index:99999;text-align:center;display:none;min-width:380px;
  animation:tipsAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  border:1px solid rgba(255,255,255,0.8);
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
}
.success-tips::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:6px;
  background:linear-gradient(to right, #1f56b3, #4a90e2, #1f56b3);
  border-radius:20px 20px 0 0;
}
@keyframes tipsAppear {
  from {opacity:0;transform:translate(-50%,-60%) scale(0.9);}
  to {opacity:1;transform:translate(-50%,-50%) scale(1);}
}

.tips-text{font-size:18px;color:#333;margin-bottom:30px;line-height:1.7;}
.tips-text::before{content:'ğŸ’Œ';display:block;font-size:48px;margin-bottom:20px;animation:float 2s ease-in-out infinite;}

.tips-btn{padding:14px 40px;background:linear-gradient(135deg, #1f56b3, #3a7bd5);color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.3s;letter-spacing:1px;box-shadow:0 6px 25px rgba(31,86,179,0.3);position:relative;overflow:hidden;}
.tips-btn:hover{background:linear-gradient(135deg, #174a9e, #2e6bc8);transform:translateY(-3px);box-shadow:0 10px 30px rgba(31,86,179,0.4);}

/* ç™»å½•æé†’å¼¹çª—ä¼˜åŒ– */
.login-reminder {
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  background:#fff;padding:40px 50px;border-radius:20px;box-shadow:0 15px 50px rgba(0,0,0,0.25);
  z-index:10000;text-align:center;display:none;min-width:380px;
  animation:modalSlideUp 0.4s ease;border:1px solid rgba(255,255,255,0.8);backdrop-filter:blur(10px);
}
.login-reminder::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:6px;
  background:linear-gradient(to right, #1f56b3, #4a90e2, #1f56b3);
  border-radius:20px 20px 0 0;
}

.reminder-text {
  font-size:18px;color:#333;margin-bottom:35px;line-height:1.7;
}
.reminder-text::before{content:'ğŸ”';display:block;font-size:42px;margin-bottom:20px;animation:pulse 2s ease-in-out infinite;}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.reminder-btn {
  padding:13px 32px;background:linear-gradient(135deg, #1f56b3, #3a7bd5);
  color:white;border:none;border-radius:12px;cursor:pointer;
  font-size:15px;font-weight:600;margin:0 10px;transition:all 0.3s;box-shadow:0 4px 15px rgba(31,86,179,0.25);
}
.reminder-btn:hover {
  background:linear-gradient(135deg, #174a9e, #2e6bc8);transform:translateY(-3px);box-shadow:0 8px 20px rgba(31,86,179,0.35);
}
.reminder-btn:last-child{background:#f0f7ff;color:#1f56b3;border:1px solid #d5e4ff;}
.reminder-btn:last-child:hover{background:#e1eeff;}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 1024px){
  .building-container{
    grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));
    gap:20px;
  }
}

@media (max-width: 768px){
  .header{
    padding:25px 20px;
  }
  .page-title{
    font-size:30px;
    margin-left:50px;
    margin-right:20px;
  }
  .subtitle{
    font-size:15px;
  }
  .building-container{
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:18px;
  }
  .building-name{
    padding:15px;
    font-size:16px;
  }
  .modal-box{
    padding:25px 20px;
  }
  .success-tips,.login-reminder{
    min-width:320px;
    padding:30px 35px;
  }
  .reminder-btn{
    padding:12px 25px;
    margin:0 8px;
  }
}

@media (max-width: 480px){
  .page-title{
    font-size:26px;
    margin-left:0;
    margin-right:0;
  }
  .back-btn{
    position:relative;
    left:0;
    top:0;
    transform:none;
    margin-bottom:15px;
    display:inline-flex;
    width:auto;
  }
  .building-container{
    grid-template-columns:1fr;
    gap:16px;
  }
  .modal-box{
    width:95vw;
    padding:22px 18px;
  }
  .btns-group{
    flex-direction:column;
    gap:12px;
  }
  .memory-avatar{
    width:44px;
    height:44px;
  }
  .success-tips,.login-reminder{
    min-width:280px;
    padding:25px 30px;
  }
  .reminder-btn{
    padding:11px 20px;
    margin:0 6px;
    font-size:14px;
  }
}

/* æ·»åŠ ä¸€äº›å¾®å¦™çš„åŠ¨ç”»æ•ˆæœ */
@keyframes cardAppear {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.building-card {
  animation: cardAppear 0.6s ease-out forwards;
  animation-delay: calc(var(--card-index, 0) * 0.1s);
  opacity: 0;
}

/* ä¸ºå¡ç‰‡æ·»åŠ ç´¢å¼• */
.building-card:nth-child(1) { --card-index: 1; }
.building-card:nth-child(2) { --card-index: 2; }
.building-card:nth-child(3) { --card-index: 3; }
.building-card:nth-child(4) { --card-index: 4; }
.building-card:nth-child(5) { --card-index: 5; }
.building-card:nth-child(6) { --card-index: 6; }
.building-card:nth-child(7) { --card-index: 7; }
.building-card:nth-child(8) { --card-index: 8; }
.building-card:nth-child(9) { --card-index: 9; }
.building-card:nth-child(10) { --card-index: 10; }
.building-card:nth-child(11) { --card-index: 11; }
.building-card:nth-child(12) { --card-index: 12; }
.building-card:nth-child(13) { --card-index: 13; }
.building-card:nth-child(14) { --card-index: 14; }
.building-card:nth-child(15) { --card-index: 15; }
.building-card:nth-child(16) { --card-index: 16; }
</style>
</head>
<body>
<div class="bg"></div>
<div class="header">
  <a class="back-btn" href="/">â† è¿”å›é¦–é¡µ</a>
  <h1 class="page-title">æ ¡å›­å»ºç­‘Â·å…±äº«å›å¿†å¢™</h1>
  <p class="subtitle">ç‚¹å‡»å»ºç­‘ç•™ä¸‹ä½ çš„æ ¡å›­è®°å¿†</p>
</div>
<div class="building-container">
  <!-- å…¨éƒ¨16ä¸ªæ ¡å›­åœºæ™¯ -->
  <div class="building-card" onclick="showModal('ä½“è‚²åœº')">
    <img src="/static/ä½“è‚²åœº.jpg" class="building-img" alt="ä½“è‚²åœº" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">ä½“è‚²åœº</div>
  </div>
  <div class="building-card" onclick="showModal('æ•™å­¦å®éªŒç»¼åˆæ¥¼')">
    <img src="/static/æ•™å­¦å®éªŒç»¼åˆæ¥¼.jpg" class="building-img" alt="æ•™å­¦å®éªŒç»¼åˆæ¥¼" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">æ•™å­¦å®éªŒç»¼åˆæ¥¼</div>
  </div>
  <div class="building-card" onclick="showModal('å›¾ä¹¦é¦†')">
    <img src="/static/å›¾ä¹¦é¦†.jpg" class="building-img" alt="å›¾ä¹¦é¦†" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å›¾ä¹¦é¦†</div>
  </div>
  <div class="building-card" onclick="showModal('å®¿èˆæ¥¼')">
    <img src="/static/å®¿èˆæ¥¼.jpg" class="building-img" alt="å®¿èˆæ¥¼" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å®¿èˆæ¥¼</div>
  </div>
  <div class="building-card" onclick="showModal('ç¤¼å ‚')">
    <img src="/static/ç¤¼å ‚.jpg" class="building-img" alt="ç¤¼å ‚" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">ç¤¼å ‚</div>
  </div>
  <div class="building-card" onclick="showModal('å­¦ç”Ÿé¤å…')">
    <img src="/static/å­¦ç”Ÿé¤å….jpg" class="building-img" alt="å­¦ç”Ÿé¤å…" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å­¦ç”Ÿé¤å…</div>
  </div>
  <div class="building-card" onclick="showModal('æ ¡å›­æ¹–')">
    <img src="/static/æ ¡å›­æ¹–.jpg" class="building-img" alt="æ ¡å›­æ¹–" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">æ ¡å›­æ¹–</div>
  </div>
  <div class="building-card" onclick="showModal('é©¬å…‹æ€ä¸»ä¹‰å­¦é™¢')">
    <img src="/static/é©¬å…‹æ€ä¸»ä¹‰å­¦é™¢.jpg" class="building-img" alt="é©¬å…‹æ€ä¸»ä¹‰å­¦é™¢" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">é©¬å…‹æ€ä¸»ä¹‰å­¦é™¢</div>
  </div>
  <div class="building-card" onclick="showModal('å·¥ç¨‹å®éªŒæ¥¼')">
    <img src="/static/å·¥ç¨‹å®éªŒæ¥¼.jpg" class="building-img" alt="å·¥ç¨‹å®éªŒæ¥¼" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å·¥ç¨‹å®éªŒæ¥¼</div>
  </div>
  <div class="building-card" onclick="showModal('ç†å­¦é™¢')">
    <img src="/static/ç†å­¦é™¢.jpg" class="building-img" alt="ç†å­¦é™¢" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">ç†å­¦é™¢</div>
  </div>
  <div class="building-card" onclick="showModal('æ™ºèƒ½å·¥ç¨‹ä¸è‡ªåŠ¨åŒ–å­¦é™¢')">
    <img src="/static/æ™ºèƒ½å·¥ç¨‹ä¸è‡ªåŠ¨åŒ–å­¦é™¢.jpg" class="building-img" alt="æ™ºèƒ½å·¥ç¨‹ä¸è‡ªåŠ¨åŒ–å­¦é™¢" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">æ™ºèƒ½å·¥ç¨‹ä¸è‡ªåŠ¨åŒ–å­¦é™¢</div>
  </div>
  <div class="building-card" onclick="showModal('æ•°å­—åª’ä½“ä¸è‰ºæœ¯è®¾è®¡å­¦é™¢')">
    <img src="/static/æ•°å­—åª’ä½“ä¸è‰ºæœ¯è®¾è®¡å­¦é™¢.jpg" class="building-img" alt="æ•°å­—åª’ä½“ä¸è‰ºæœ¯è®¾è®¡å­¦é™¢" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">æ•°å­—åª’ä½“ä¸è‰ºæœ¯è®¾è®¡å­¦é™¢</div>
  </div>
  <div class="building-card" onclick="showModal('ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢')">
    <img src="/static/ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢.jpg" class="building-img" alt="ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢</div>
  </div>
  <div class="building-card" onclick="showModal('å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ')">
    <img src="/static/å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ.jpg" class="building-img" alt="å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ</div>
  </div>
  <div class="building-card" onclick="showModal('æ•™èŒå·¥é£Ÿå ‚')">
    <img src="/static/æ•™èŒå·¥é£Ÿå ‚.jpg" class="building-img" alt="æ•™èŒå·¥é£Ÿå ‚" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">æ•™èŒå·¥é£Ÿå ‚</div>
  </div>
  <div class="building-card" onclick="showModal('å¤©çŒ«è¶…å¸‚')">
    <img src="/static/å¤©çŒ«è¶…å¸‚.jpg" class="building-img" alt="å¤©çŒ«è¶…å¸‚" onerror="this.src='/static/default-building.jpg'">
    <div class="building-name">å¤©çŒ«è¶…å¸‚</div>
  </div>
</div>

<!-- å›å¿†å¼¹çª— -->
<div class="modal" id="memModal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <span class="close-btn" onclick="closeModal()">Ã—</span>
    <h3 class="modal-title" id="modalTitle">ä½“è‚²åœºÂ·æˆ‘çš„å›å¿†</h3>
    <textarea class="memory-input" id="memContent" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ ä¸è¿™ä¸ªæ ¡å›­å»ºç­‘çš„å›å¿†å§ï½ âœ¨"></textarea>

    <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <div class="upload-area" onclick="event.stopPropagation();document.getElementById('imageInput').click()">
      <div class="upload-icon">ğŸ“·</div>
      <div class="upload-text">ç‚¹å‡»æ·»åŠ å›¾ç‰‡ï¼ˆæœ€å¤š3å¼ ï¼‰</div>
      <div class="upload-hint">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæ¯å¼ ä¸è¶…è¿‡2MB</div>
    </div>
    <input type="file" id="imageInput" accept="image/*" multiple style="display:none" onchange="handleImageSelect(event)">

    <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
    <div id="imagePreview"></div>

    <div class="btns-group">
      <button class="save-btn" onclick="submitMem()">æäº¤å…±äº«å›å¿†</button>
      <button class="view-btn" onclick="viewMem()">æŸ¥çœ‹æ‰€æœ‰å›å¿†</button>
    </div>
    <div class="memory-container" id="memList"></div>
  </div>
</div>

<!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
<div class="img-modal" id="imgBigModal" onclick="closeImageModal()">
  <span class="close-img" onclick="closeImageModal()">Ã—</span>
  <img class="big-img" id="bigImgShow">
</div>

<!-- æ¸©æŸ”æç¤ºå¼¹çª— -->
<div class="success-tips" id="tipsBox" onclick="closeTips()">
  <div class="tips-text">ğŸ’Œ è®°å¿†å·²å°å­˜<br>ä½ çš„æ ¡å›­æ•…äº‹è¢«æ—¶å…‰èƒ¶å›Šçè— âœ¨</div>
  <button class="tips-btn" onclick="closeTips()">å¥½å‘€</button>
</div>

<!-- ç™»å½•æé†’å¼¹çª— -->
<div class="login-reminder" id="loginReminder" onclick="closeLoginReminder()">
  <div class="reminder-text">è¯·å…ˆç™»å½•ï¼Œå†åˆ†äº«ä½ çš„æ ¡å›­å›å¿†ï½</div>
  <button class="reminder-btn" onclick="goToLogin()">å»ç™»å½•</button>
  <button class="reminder-btn" onclick="closeLoginReminder()">ç¨åå†è¯´</button>
</div>

<script>
// APIåŸºç¡€URL
const API_BASE = '/api';
let nowScene = '';
let selectedImages = [];
let currentUser = null;

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
window.onload = async function() {
  await checkLoginStatus();
}

// æ£€æŸ¥ç™»å½•çŠ¶æ€ - ä¿®å¤ç‰ˆ
async function checkLoginStatus() {
  try {
    const response = await fetch(`${API_BASE}/check-login`);
    const data = await response.json();

    if (data.logged_in && data.user) {
      currentUser = data.user;
      console.log('å½“å‰ç™»å½•ç”¨æˆ·:', currentUser);
    } else {
      currentUser = null;
    }
  } catch (error) {
    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
    currentUser = null;
  }
}

// è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ - ä¿®å¤ç‰ˆ
function getCurrentUserInfo() {
  if (currentUser && currentUser.id) {
    return {
      id: currentUser.id.toString(),
      nickname: currentUser.nickname || currentUser.username || 'æœªç™»å½•ç”¨æˆ·',
      avatar: currentUser.avatar || '',
      name: currentUser.username || ''
    };
  }
  return {
    id: '',
    nickname: 'æœªç™»å½•ç”¨æˆ·',
    avatar: '',
    name: ''
  };
}

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
function checkLogin() {
  return currentUser !== null && currentUser.id;
}

// ========== æ–°å¢ï¼šå‘é€é€šçŸ¥åˆ°ä¸»é¡µé‚®ç®± ==========
function sendNotificationToHome(type, fromUser, toUser, scene, content) {
  // è¯»å–å·²æœ‰çš„é€šçŸ¥
  let notifications = JSON.parse(localStorage.getItem('mailNotifications')) || [];
  notifications.push({
    type: type, // 'like' æˆ– 'reply'
    fromUser: fromUser,
    toUser: toUser,
    scene: scene,
    content: content,
    time: new Date().toLocaleString()
  });
  localStorage.setItem('mailNotifications', JSON.stringify(notifications));
}

// ========== æ˜¾ç¤ºå¼¹çª—ç›¸å…³å‡½æ•° ==========
function showModal(scene) {
  nowScene = scene;
  document.getElementById('modalTitle').innerText = scene + 'Â·æˆ‘çš„å›å¿†';
  document.getElementById('memModal').style.display = 'flex';
  document.getElementById('memList').innerHTML = '';
  document.getElementById('memContent').value = '';
  clearImagePreview();
}

function closeModal() {
  document.getElementById('memModal').style.display = 'none';
  clearImagePreview();
}

function clearImagePreview() {
  selectedImages = [];
  document.getElementById('imagePreview').innerHTML = '';
  document.getElementById('imageInput').value = '';
}

function handleImageSelect(event) {
  const files = event.target.files;
  const maxImages = 3;
  const maxSize = 2 * 1024 * 1024;

  if (selectedImages.length + files.length > maxImages) {
    alert(`æœ€å¤šåªèƒ½é€‰æ‹©${maxImages}å¼ å›¾ç‰‡å“¦ï½`);
    event.target.value = '';
    return;
  }

  for (let i = 0; i < files.length && selectedImages.length < maxImages; i++) {
    const file = files[i];
    if (file.size > maxSize) {
      alert(`å›¾ç‰‡"${file.name}"è¶…è¿‡2MBï¼Œè¯·é€‰æ‹©æ›´å°çš„å›¾ç‰‡ï½`);
      continue;
    }
    if (!file.type.match('image.*')) {
      alert(`æ–‡ä»¶"${file.name}"ä¸æ˜¯å›¾ç‰‡æ ¼å¼å“¦ï½`);
      continue;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      selectedImages.push({
        name: file.name,
        data: e.target.result,
        type: file.type,
        file: file  // ä¿ç•™æ–‡ä»¶å¯¹è±¡ç”¨äºFormDataä¸Šä¼ 
      });
      updateImagePreview();
    };
    reader.readAsDataURL(file);
  }
  event.target.value = '';
}

function updateImagePreview() {
  const previewDiv = document.getElementById('imagePreview');
  previewDiv.innerHTML = '';

  if (selectedImages.length === 0) return;

  selectedImages.forEach((image, index) => {
    const previewItem = document.createElement('div');
    previewItem.className = 'preview-item';
    previewItem.innerHTML = `
      <img src="${image.data}" class="preview-img" alt="é¢„è§ˆå›¾ç‰‡">
      <button class="remove-img" onclick="removeImage(${index})">Ã—</button>
    `;
    previewDiv.appendChild(previewItem);
  });
}

function removeImage(index) {
  selectedImages.splice(index, 1);
  updateImagePreview();
}

function closeImageModal() {
  document.getElementById('imgBigModal').style.display = 'none';
}

function viewLargeImage(imageSrc) {
  document.getElementById('bigImgShow').src = imageSrc;
  document.getElementById('imgBigModal').style.display = 'flex';
}

function closeTips() {
  document.getElementById('tipsBox').style.display = 'none';
}

function goToLogin() {
  window.location.href = '/';
}

function closeLoginReminder() {
  document.getElementById('loginReminder').style.display = 'none';
}

// ========== æŸ¥çœ‹å›å¿† - è¿æ¥åˆ°åç«¯API ==========
async function viewMem() {
  const list = document.getElementById('memList');
  list.innerHTML = '<div class="no-memories">åŠ è½½ä¸­...</div>';

  try {
    const response = await fetch(`${API_BASE}/campus/memories/${encodeURIComponent(nowScene)}`);
    const data = await response.json();

    if (!data.success) {
      list.innerHTML = '<div class="no-memories">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
      return;
    }

    const memories = data.memories || [];

    if (memories.length === 0) {
      list.innerHTML = '<div class="no-memories">æš‚æ— å›å¿†ï¼Œå¿«æ¥åˆ†äº«ç¬¬ä¸€ä¸ªå§ï½ âœ¨</div>';
      return;
    }

    console.log(`æ˜¾ç¤º${nowScene}çš„${memories.length}æ¡å›å¿†`);

    // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
    const currentUserInfo = getCurrentUserInfo();
    const currentUserId = currentUserInfo.id;

    const memoriesHTML = memories.map((memory, idx) => {
      const user = memory.user_info || {
        nickname: memory.name || 'æœªç™»å½•ç”¨æˆ·',
        avatar: memory.avatar || ''
      };

      let avatarHTML = '';
      if (user.avatar && user.avatar !== '') {
        avatarHTML = `<img src="${user.avatar}" alt="${user.nickname}çš„å¤´åƒ" onerror="this.parentElement.innerHTML='<div style=\"display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:18px;\">${user.nickname.charAt(0) || 'æœª'}</div>'">`;
      } else {
        const firstChar = user.nickname.charAt(0) || 'æœª';
        avatarHTML = `<div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:18px;">${firstChar}</div>`;
      }

      // å¤„ç†å›¾ç‰‡ï¼ˆå‡è®¾åç«¯è¿”å›çš„å›¾ç‰‡æ˜¯base64å­—ç¬¦ä¸²æ•°ç»„ï¼‰
      let imagesHTML = '';
      if (memory.images && memory.images.length > 0) {
        const imagesToShow = memory.images.slice(0, 4);
        imagesHTML = `<div class="memory-images">
          ${imagesToShow.map((imgSrc, imgIdx) => `
            <div class="memory-image-item" onclick="viewLargeImage('${imgSrc}')">
              <img src="${imgSrc}" alt="å›å¿†å›¾ç‰‡">
              ${imgIdx === 3 && memory.images.length > 4 ? `<div class="image-count">+${memory.images.length - 4}</div>` : ''}
            </div>
          `).join('')}
        </div>`;
      }

      // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯å›å¿†çš„ä½œè€…
      const isAuthor = memory.user_id && currentUser && memory.user_id.toString() === currentUser.id.toString();

      return `
<div class="memory-item" data-id="${memory.id}">
  <div class="user-header">
    <div class="memory-avatar">${avatarHTML}</div>
    <div class="user-info">
      <div class="memory-nickname">${user.nickname}</div>
      <div class="memory-time">${memory.time || memory.created_at}</div>
    </div>

    <!-- åˆ é™¤æŒ‰é’®ï¼ˆåªæœ‰ä½œè€…è‡ªå·±èƒ½çœ‹åˆ°ï¼‰ -->
    ${isAuthor ? `
      <button onclick="deleteMemory(${memory.id})"
        style="padding:4px 12px;border-radius:6px;border:none;background:#ff4757;color:#fff;cursor:pointer;font-size:13px;margin-left:auto;">
        ğŸ—‘ï¸ åˆ é™¤
      </button>
    ` : ''}
  </div>
  ${memory.content ? `<div class="memory-text">${memory.content}</div>` : ''}
  ${imagesHTML}
  <div style="margin-top:10px;display:flex;align-items:center;gap:10px;">
    <button onclick="likeMemory(${memory.id}, '${user.nickname}', '${nowScene}')"
      style="padding:6px 14px;border-radius:8px;border:none;background:#1f56b3;color:#fff;cursor:pointer;">
      ğŸ‘ ç‚¹èµ
    </button>
    <span id="likeCount-${memory.id}" style="font-size:14px;color:#888;"></span>
  </div>
  <!-- è¯„è®ºåŒº -->
  <div style="margin-top:8px;display:flex;gap:6px;">
    <input type="text" placeholder="å†™æ¡è¯„è®º..." id="commentInput-${memory.id}"
      style="padding:6px 10px;border-radius:8px;border:1px solid #ccc;flex:1;"
      onkeypress="if(event.key==='Enter') commentMemory('${memory.id}', '${user.nickname}', '${nowScene}', this)">
    <button onclick="commentMemoryWithButton('${memory.id}', '${user.nickname}', '${nowScene}')"
      style="padding:6px 12px;border-radius:8px;border:none;background:#1f56b3;color:#fff;cursor:pointer;">
      å‘é€
    </button>
  </div>
  <div id="comments-${memory.id}" style="margin-top:8px;font-size:14px;color:#555;"></div>
</div>`;
    }).join('');

    list.innerHTML = memoriesHTML;
    list.scrollTop = 0;

    // åŠ è½½ç‚¹èµæ•°ï¼ˆæš‚æ—¶ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼‰
    memories.forEach(memory => {
      let likes = JSON.parse(localStorage.getItem('likes_' + memory.id)) || [];
      document.getElementById('likeCount-' + memory.id).textContent = `${likes.length} èµ`;
    });

  } catch (error) {
    console.error('åŠ è½½å›å¿†å¤±è´¥:', error);
    list.innerHTML = '<div class="no-memories">åŠ è½½å›å¿†å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
  }
}

// ========== æäº¤å›å¿† - è¿æ¥åˆ°åç«¯API ==========
async function submitMem() {
  if (!checkLogin()) {
    document.getElementById('loginReminder').style.display = 'block';
    return;
  }

  const content = document.getElementById('memContent').value.trim();
  if (!content && selectedImages.length === 0) {
    alert('è¯·è¾“å…¥æ–‡å­—å›å¿†æˆ–æ·»åŠ å›¾ç‰‡ï½');
    return;
  }

  try {
    // åˆ›å»ºFormDataå¯¹è±¡
    const formData = new FormData();
    formData.append('building', nowScene);
    formData.append('content', content);

    // æ·»åŠ å›¾ç‰‡æ–‡ä»¶
    selectedImages.forEach((image, index) => {
      if (image.file) {
        formData.append('images', image.file);
      }
    });

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const saveBtn = document.querySelector('.save-btn');
    const originalText = saveBtn.textContent;
    saveBtn.textContent = 'æäº¤ä¸­...';
    saveBtn.disabled = true;

    const response = await fetch(`${API_BASE}/campus/memories`, {
      method: 'POST',
      body: formData
    });

    const data = await response.json();

    // æ¢å¤æŒ‰é’®çŠ¶æ€
    saveBtn.textContent = originalText;
    saveBtn.disabled = false;

    if (data.success) {
      document.getElementById('memModal').style.display = 'none';
      document.getElementById('tipsBox').style.display = 'block';
      document.getElementById('memContent').value = '';
      clearImagePreview();

      // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      showAlert('æäº¤æˆåŠŸï¼', 'success');
    } else {
      alert(data.message || 'æäº¤å¤±è´¥');
    }
  } catch (error) {
    console.error('æäº¤å›å¿†å¤±è´¥:', error);
    alert('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    const saveBtn = document.querySelector('.save-btn');
    saveBtn.textContent = 'æäº¤å…±äº«å›å¿†';
    saveBtn.disabled = false;
  }
}

// ========== åˆ é™¤å›å¿†åŠŸèƒ½ ==========
async function deleteMemory(memoryId) {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å›å¿†å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) {
    return;
  }

  if (!checkLogin()) {
    alert('è¯·å…ˆç™»å½•');
    return;
  }

  try {
    const response = await fetch(`${API_BASE}/campus/memories/${memoryId}`, {
      method: 'DELETE'
    });

    const data = await response.json();

    if (data.success) {
      showAlert('åˆ é™¤æˆåŠŸï¼', 'success');
      // é‡æ–°åŠ è½½è®°å¿†åˆ—è¡¨
      viewMem();
    } else {
      showAlert(data.message || 'åˆ é™¤å¤±è´¥', 'error');
    }
  } catch (error) {
    console.error('åˆ é™¤å¤±è´¥:', error);
    showAlert('åˆ é™¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
  }
}

// ========== ç‚¹èµåŠŸèƒ½ ==========
function likeMemory(id, toUser, scene) {
  if(!checkLogin()){
    alert('è¯·å…ˆç™»å½•æ‰èƒ½ç‚¹èµ');
    return;
  }

  let likes = JSON.parse(localStorage.getItem('likes_' + id)) || [];
  const me = getCurrentUserInfo().nickname;

  if(likes.includes(me)){
    alert('ä½ å·²ç»ç‚¹è¿‡èµå•¦');
    return;
  }

  likes.push(me);
  localStorage.setItem('likes_' + id, JSON.stringify(likes));
  document.getElementById('likeCount-' + id).textContent = `${likes.length} èµ`;

  // å‘é€é€šçŸ¥
  sendNotificationToHome('like', me, toUser, scene, 'ç‚¹èµäº†ä½ çš„å›å¿†');
}

// ========== è¯„è®ºåŠŸèƒ½ ==========
function commentMemory(id, toUser, scene, inputEl) {
  commentMemoryWithButton(id, toUser, scene);
}

function commentMemoryWithButton(id, toUser, scene) {
  const input = document.getElementById(`commentInput-${id}`);
  const txt = input.value.trim();

  if (!checkLogin()) {
    alert('è¯·å…ˆç™»å½•');
    return;
  }

  if (!txt) {
    alert('è¯„è®ºä¸èƒ½ä¸ºç©º');
    return;
  }

  let comments = JSON.parse(localStorage.getItem('comments_' + id)) || [];
  const me = getCurrentUserInfo().nickname;

  comments.push({
    user: me,
    text: txt,
    time: new Date().toLocaleString()
  });

  localStorage.setItem('comments_' + id, JSON.stringify(comments));
  input.value = '';
  renderComments(id, comments);

  // å‘é€é€šçŸ¥
  sendNotificationToHome('reply', me, toUser, scene, txt);
}

function renderComments(id, comments) {
  const div = document.getElementById('comments-' + id);
  if(!comments.length){
    div.innerHTML = '';
    return;
  }
  div.innerHTML = `<strong>è¯„è®ºï¼š</strong>` +
    comments.map(c => `<div><b>${c.user}</b>: ${c.text} <small>(${c.time})</small></div>`).join('');
}

// ========== æ˜¾ç¤ºæ¶ˆæ¯ ==========
function showAlert(message, type) {
  const colors = {
    success: 'linear-gradient(90deg, #4CAF50, #45a049)',
    error: 'linear-gradient(90deg, #f44336, #d32f2f)'
  };

  const alertDiv = document.createElement('div');
  alertDiv.textContent = message;
  alertDiv.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${colors[type] || colors.success};
    color: white;
    padding: 12px 24px;
    border-radius: 10px;
    z-index: 1000;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    font-weight: 600;
    animation: slideIn 0.3s ease;
  `;
  document.body.appendChild(alertDiv);

  setTimeout(() => {
    alertDiv.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => alertDiv.remove(), 300);
  }, 2000);

  // æ·»åŠ åŠ¨ç”»æ ·å¼
  if (!document.getElementById('alertAnimations')) {
    const style = document.createElement('style');
    style.id = 'alertAnimations';
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  }
}

// ESCé”®å…³é—­æ‰€æœ‰å¼¹çª—
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeModal();
    closeImageModal();
    closeTips();
    closeLoginReminder();
  }
});
</script>
</body>
</html>